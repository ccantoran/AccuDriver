<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/css/styles.css">
  <!-- external font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans&display=swap" rel="stylesheet">
  <!-- favicon -->
  <link rel="shortcut icon" type="image/jpg" href="img/favi.png?v=1"/>
  <title>AccuDriver Dashboard</title>
</head>
<body>
  <nav>
    <img src="img/nav.png">
    <div class="nav-div">
      <p>Welcome <strong><%= user.userName %></strong>!</p>
      <a href="/logout">Logout</a>
    </div>
  </nav>
  <main class="dashboard-main">
    
        <% var newDate = new Date().toString().slice(0, 10)%>

  
      <ul class="driver-grid">

        <!-- drivers in DB -->
        <% for(var i=0; i<drivers.length; i++) {%>
          <li>
            <div class="bold"><%= drivers[i].name %></div>
            <a href="/driver/<%= drivers[i]._id%>">
              <img class="driver-img" src="<%= drivers[i].image%>">
            </a>

            <div class="times">              
              <div class="starts">
                <div><%= newDate %></div>

                <!-- Scan thru all starts -->
                <% for(var j=0; j<start.length; j++) {%>
                  <% var startDate = start[j].time.toString().slice(0, 10) %>

                <!-- Driver match to starts -->
                  <% if (drivers[i]._id == start[j].id && startDate == newDate) {%>
                    <% let startTime = start[j].time %>
                    <% let startHour = start[j].time.toString().slice(16, 18) %>
                    <% let startMin = start[j].time.toString().slice(19, 21) %>

                <!-- Date changed to readable format -->
                      <% if(startHour > 12) {%>
                        <% var startStamp = `${startHour - 12}:${startMin} PM`%>
                      <%}else {%>
                        <% var startStamp =`${startHour - 12}:${startMin} PM` %>
                      <%} %>

                    <div><%= startStamp %></div>
                  
                  <%} %>
                <% } %>
              </div>
            
              <div class="stops">
                <div><%= newDate %></div>
                
                <!-- Scan thru all the stops -->
                <% for(var q=0; q<stop.length; q++) {%>
                  <% var stopDate = stop[q].time.toString().slice(0, 10) %>

                <!-- Driver match to stops -->
                  <% if (drivers[i]._id == stop[q].id && stopDate == newDate) {%>

                    <% let stopTime = stop[q].time %>
                    <% let stopHour = stop[q].time.toString().slice(16, 18) %>
                    <% let stopMin = stop[q].time.toString().slice(19, 21) %>

                <!-- Date changed to readable format -->
                      <% if(stopHour > 12) {%>
                        <% var stopStamp = `${stopHour - 12}:${stopMin} PM`%>
                      <%}else {%>
                        <% var stopStamp =`${stopHour - 12}:${stopMin} PM` %>
                      <%} %>

                    <div><%= stopStamp %></div>
                  <%} %>
                <% } %>
              </div>
            
            </div>

            <div class="driver-btns">
              <form action="/driver/start/<%= drivers[i]._id%>" method="POST">
                <button>start</button>
              </form>
              <form action="/driver/stop/<%= drivers[i]._id%>" method="POST">
                <button>stop</button>
              </form>
            </div>
            

          </li>
        <% } %>

        <!-- create driver form -->
        <li>
          <div class="bold">Add a Driver</div>
          <img class="driver-img" src="img/blank.png">
          <form action="/driver/createDriver" enctype="multipart/form-data" method="POST" class="add-driver">
            <div class="upload-file">
             <input type="file" id="imageUpload" name="file">
            </div>

            <div>
              <label for="name">Enter name</label>
               <input type="text" id="name" name="name" class="margin-3">
            </div>
            <button type="submit" value="Upload" class="margin-3">Submit</button>
          </form>
        </li>

      </ul>
  </main> 
  <footer>
  
  </footer>

</body>
</html>
